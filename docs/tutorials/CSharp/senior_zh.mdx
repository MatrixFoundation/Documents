---
sidebar_label: C# é«˜çº§ç‰¹æ€§
title: C# é«˜çº§ç‰¹æ€§
sidebar_position: 6
---

## ä¸€ã€å†…å­˜ç®¡ç†å’Œåƒåœ¾å›æ”¶ ğŸ“¦

åœ¨`C#`ä¸­ï¼Œç”±äºåƒåœ¾æ”¶é›†å™¨æœºåˆ¶ï¼Œå†…å­˜ç®¡ç†æ˜¯è‡ªåŠ¨å¤„ç†çš„ã€‚

:::info

åƒåœ¾å›æ”¶ ï¼ˆGCï¼‰ æ˜¯è¿è¡Œæ—¶è‡ªåŠ¨å›æ”¶ä¸å†ä½¿ç”¨çš„å¯¹è±¡æ‰€å ç”¨çš„å†…å­˜çš„è¿‡ç¨‹ï¼Œå¯ä»¥é˜²æ­¢å†…å­˜æ³„æ¼å¹¶ä¿ƒè¿›å†…å­˜çš„é«˜æ•ˆåˆ©ç”¨ã€‚

:::

å®ƒè‡ªåŠ¨è¯†åˆ«ç¨‹åºä¸å†ä½¿ç”¨çš„å¯¹è±¡å¹¶é‡Šæ”¾å®ƒä»¬å ç”¨çš„å†…å­˜ã€‚è™½ç„¶åƒåœ¾æ”¶é›†å™¨ç®€åŒ–äº†å†…å­˜ç®¡ç†ï¼Œä½†å¼€å‘äººå‘˜éœ€è¦ä»”ç»†ç®¡ç†ä¸å— .NET åƒåœ¾æ”¶é›†å™¨æ§åˆ¶çš„éæ‰˜ç®¡èµ„æºï¼Œä¾‹å¦‚æ•°æ®åº“è¿æ¥æˆ–æ–‡ä»¶æµã€‚

:::tip

æ ˆå’Œå †ï¼šåœ¨ `C#` ä¸­ï¼Œå†…å­˜åˆ†ä¸ºä¸¤ä¸ªä¸»è¦åŒºåŸŸï¼šæ ˆå’Œå †ã€‚æ ˆç”¨äºå­˜å‚¨å€¼ç±»å‹å’Œæ–¹æ³•è°ƒç”¨ä¿¡æ¯ï¼Œè€Œå †ç”¨äºåŠ¨æ€åˆ†é…å†…å­˜ï¼Œä¸»è¦ç”¨äºå¼•ç”¨ç±»å‹ã€‚

:::

å¦‚æœå¼€å‘äººå‘˜ä¸é‡Šæ”¾è¿™äº›èµ„æºï¼Œå®ƒä»¬å°†åœ¨åº”ç”¨ç¨‹åºçš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­æŒç»­å­˜åœ¨ï¼Œå¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼å’Œç³»ç»Ÿå‹åŠ›ã€‚

:::tip

å€¼ç±»å‹ä¸å¼•ç”¨ç±»å‹ï¼šå€¼ç±»å‹ï¼ˆä¾‹å¦‚ï¼Œintï¼Œfloatï¼‰å­˜å‚¨åœ¨æ ˆä¸Šï¼Œè€Œå¼•ç”¨ç±»å‹ï¼ˆä¾‹å¦‚ï¼Œç±»ï¼Œæ•°ç»„ï¼‰åˆ†é…åœ¨å †ä¸Šã€‚å¼•ç”¨ç±»å‹å­˜å‚¨å¯¹å †ä¸Šå®é™…æ•°æ®çš„å¼•ç”¨ã€‚

:::

<b>`IDisposable` æ¥å£</b>

`IDisposable` æ¥å£ç”¨äºé‡Šæ”¾éæ‰˜ç®¡èµ„æºï¼Œä¾‹å¦‚æ–‡ä»¶å¥æŸ„ã€æ•°æ®åº“è¿æ¥æˆ–ç½‘ç»œå¥—æ¥å­—ã€‚

```csharp
public class ResourceManager : IDisposable
{
    private bool disposed = false;  // Track whether resources have been released
    private IntPtr handle;           // Example: unmanaged resource
    private Component component;      // Example: managed resource

    // Public Dispose method - called through the interface
    public void Dispose()
    {
        Dispose(true);
        GC.SuppressFinalize(this);  // Prevent finalizer from running
    }

    // Protected virtual Dispose method - allows derived classes to override
    protected virtual void Dispose(bool disposing)
    {
        if (!disposed)
        {
            if (disposing)
            {
                // Release managed resources
                if (component != null)
                {
                    component.Dispose();
                    component = null;
                }
            }

            // Release unmanaged resources
            if (handle != IntPtr.Zero)
            {
                Marshal.FreeHGlobal(handle);
                handle = IntPtr.Zero;
            }

            disposed = true;
        }
    }

    ~ResourceManager()
    {
        Dispose(false);
    }

    // Check if disposed before use
    protected void ThrowIfDisposed()
    {
        if (disposed)
        {
            throw new ObjectDisposedException(GetType().Name);
        }
    }
}
```

<b>`using` è¯­å¥</b>

```csharp
// Traditional syntax
using (var resource = new ResourceManager())
{
    resource.DoWork();
}  // Automatically calls Dispose()

// C# 8.0+ simplified syntax
using var resource = new ResourceManager();
resource.DoWork();
// Dispose() is automatically called at the end of the scope
```

## äºŒã€æ–‡ä»¶ IO æ“ä½œä¸åºåˆ—åŒ– ğŸ’»

æ–‡ä»¶è¾“å…¥/è¾“å‡ºï¼ˆI/Oï¼‰å’Œåºåˆ—åŒ–æ˜¯ `C#` ç¼–ç¨‹çš„é‡è¦æ–¹é¢ï¼Œæ¶‰åŠä»æ–‡ä»¶ä¸­è¯»å–å’Œå†™å…¥ï¼Œä»¥åŠå°†å¯¹è±¡è½¬æ¢ä¸ºé€‚åˆå­˜å‚¨æˆ–ä¼ è¾“çš„æ ¼å¼ã€‚

### 1ã€æ–‡ä»¶ I/O ğŸ“

```csharp
// Reading text from a file
string filePath = "example.txt";
string content = File.ReadAllText(filePath);

// Writing text to a file
string filePath = "example.txt";
string content = "Hello, File I/O!";
File.WriteAllText(filePath, content);

// Reading lines from a file
string filePath = "example.txt";
string[] lines = File.ReadAllLines(filePath);

// Writing lines to a file
string filePath = "example.txt";
string[] lines = { "Line 1", "Line 2", "Line 3" };
File.WriteAllLines(filePath, lines);
```

```csharp
using System.IO;

// Define the file path
string filePath = "example.txt";

// Checking if a file exists
bool fileExists = File.Exists(filePath);
if (fileExists)
{
    // Deleting a file
    File.Delete(filePath);
    Console.WriteLine("File deleted successfully.");
}
else
{
    Console.WriteLine("File does not exist.");
}
```

### 2ã€åºåˆ—åŒ– ğŸ”—

åºåˆ—åŒ–æ˜¯å°†å¯¹è±¡æˆ–æ•°æ®ç»“æ„è½¬æ¢ä¸ºæ˜“äºå­˜å‚¨æˆ–ä¼ è¾“çš„æ ¼å¼çš„è¿‡ç¨‹ã€‚

#### äºŒè¿›åˆ¶åºåˆ—åŒ–

```csharp
using System;
using System.IO;
using System.Runtime.Serialization.Formatters.Binary;

[Serializable]
public class Person
{
    public string Name { get; set; }
    public int Age { get; set; }
}

Person person = new Person { Name = "John", Age = 30 };

BinaryFormatter binaryFormatter = new BinaryFormatter();

using (FileStream stream = new FileStream("person.bin", FileMode.Create))
{
    binaryFormatter.Serialize(stream, person);
}
```

#### äºŒè¿›åˆ¶ååºåˆ—åŒ–

```csharp
using System;
using System.IO;
using System.Runtime.Serialization.Formatters.Binary;

[Serializable]
public class Person
{
    public string Name { get; set; }
    public int Age { get; set; }
}

// Binary deserialization
BinaryFormatter binaryFormatter = new BinaryFormatter();

using (FileStream stream = new FileStream("person.bin", FileMode.Open))
{
    Person deserializedPerson = (Person)binaryFormatter.Deserialize(stream);
    Console.WriteLine($"Name: {deserializedPerson.Name}, Age: {deserializedPerson.Age}");
}
```

#### JSON åºåˆ—åŒ–å’Œååºåˆ—åŒ–

```csharp
using System.Text.Json;
using System.Text.Json.Serialization;

public class Character
{
    // JSON property renaming
    [JsonPropertyName("character_name")]
    public string Name { get; set; }

    public int Level { get; set; }

    // Ignore serialization
    [JsonIgnore]
    public string SecretCode { get; set; }

    // Conditional serialization
    [JsonIgnore(Condition = JsonIgnoreCondition.WhenWritingNull)]
    public string Title { get; set; }

    // Collection property
    public List<Item> Inventory { get; set; }
}

public class Item
{
    public string Name { get; set; }
    public int Quantity { get; set; }

    // Custom serialization converter
    [JsonConverter(typeof(CustomPriceConverter))]
    public decimal Price { get; set; }
}

public class CustomPriceConverter : JsonConverter<decimal>
{
    public override decimal Read(
        ref Utf8JsonReader reader,
        Type typeToConvert,
        JsonSerializerOptions options)
    {
        // Custom deserialization logic
        return reader.GetDecimal() * 1.1m;
    }

    public override void Write(
        Utf8JsonWriter writer,
        decimal value,
        JsonSerializerOptions options)
    {
        // Custom serialization logic
        writer.WriteNumberValue(Math.Round(value, 2));
    }
}

// JSON serialization manager
public class JsonSerializationManager
{
    // Basic serialization
    public static string Serialize(object obj)
    {
        // Configure serialization options
        var options = new JsonSerializerOptions
        {
            WriteIndented = true,  // Pretty print
            PropertyNameCaseInsensitive = true
        };

        return JsonSerializer.Serialize(obj, options);
    }

    // Basic deserialization
    public static T? Deserialize<T>(string json)
    {
        return JsonSerializer.Deserialize<T>(json);
    }

    // File serialization
    public static void SerializeToFile(object obj, string filePath)
    {
        string json = Serialize(obj);
        File.WriteAllText(filePath, json);
    }

    // Deserialize from file
    public static T? DeserializeFromFile<T>(string filePath)
    {
        string json = File.ReadAllText(filePath);
        return Deserialize<T>(json);
    }
}

public class Program
{
    public static void Main()
    {
        // Create character
        var character = new Character
        {
            Name = "Hero Allen",
            Level = 10,
            SecretCode = "HERO123",
            Title = "Savior",
            Inventory =
            [
                new() { Name = "Magic Sword", Quantity = 1, Price = 100.50m },
                new() { Name = "Healing Potion", Quantity = 5, Price = 20.75m }
            ]
        };

        // Basic serialization
        string jsonString = JsonSerializationManager.Serialize(character);
        Console.WriteLine("Serialization result:");
        Console.WriteLine(jsonString);

        // Deserialization
        var deserializedCharacter = JsonSerializationManager.Deserialize<Character>(jsonString);
        Console.WriteLine("\nDeserialization result:");
        Console.WriteLine($"Name: {deserializedCharacter?.Name}");
        if (deserializedCharacter != null) Console.WriteLine($"Level: {deserializedCharacter.Level}");

        // File serialization
        string filePath = "character.json";
        JsonSerializationManager.SerializeToFile(character, filePath);
        Console.WriteLine($"\nSaved to file: {filePath}");

        // Deserialize from file
        var fileCharacter = JsonSerializationManager.DeserializeFromFile<Character>(filePath);
        Console.WriteLine("\nFile deserialization result:");
        Console.WriteLine($"Name: {fileCharacter?.Name}");
        if (fileCharacter != null) Console.WriteLine($"Item count: {fileCharacter.Inventory.Count}");
    }
}
```

## ä¸‰ã€å§”æ‰˜ä¸äº‹ä»¶ ğŸ‘¥

å§”æ‰˜å’Œäº‹ä»¶æ˜¯ `C#` ä¸­çš„åŸºæœ¬æ¦‚å¿µï¼Œæœ‰åŠ©äºå®ç°äº‹ä»¶é©±åŠ¨ç¼–ç¨‹ã€‚å®ƒä»¬æä¾›äº†ä¸€ç§ä»¥è§£è€¦å’Œå¯æ‰©å±•çš„æ–¹å¼å¤„ç†å’Œå“åº”äº‹ä»¶çš„æ–¹æ³•ã€‚

è™½ç„¶å§”æ‰˜æœ¬è´¨ä¸Šæ˜¯ç±»å‹å®‰å…¨çš„å‡½æ•°æŒ‡é’ˆï¼Œå¯ä»¥æŒ‡å‘ä¸€ä¸ªæˆ–å¤šä¸ªæ–¹æ³•ï¼Œä½†äº‹ä»¶æ˜¯ä¸€ç§æœºåˆ¶ï¼Œå…è®¸ç±»åœ¨å‘ç”Ÿæ„Ÿå…´è¶£çš„äº‹æƒ…æ—¶é€šçŸ¥å…¶ä»–ç±»æˆ–å¯¹è±¡ã€‚

### 1ã€å§”æ‰˜ ğŸ“

`C#` ä¸­çš„å§”æ‰˜æ˜¯å¯ä»¥æŒ‡å‘æ–¹æ³•çš„å¯¹è±¡ã€‚å®ƒä»¬å…è®¸ä»¥ç±»å‹å®‰å…¨çš„æ–¹å¼å®ç°å‡½æ•°æŒ‡é’ˆæ¦‚å¿µã€‚å§”æ‰˜é€šå¸¸ç”¨äºå®ç°äº‹ä»¶å’Œå›è°ƒã€‚

å§”æ‰˜æ˜¯å®‰å…¨å°è£…æ–¹æ³•çš„ç±»å‹ï¼Œå¹¶å…è®¸å®šä¹‰å¯ä¿å­˜å¯¹è¿™äº›æ–¹æ³•çš„å¼•ç”¨çš„å˜é‡ï¼Œä»è€Œå¯ç”¨å›è°ƒæœºåˆ¶å’Œäº‹ä»¶å¤„ç†ã€‚

#### å§”æ‰˜å£°æ˜

```csharp
public delegate void MyDelegate(string message);
```

#### ä½¿ç”¨å§”æ‰˜

```csharp
public class MessageProcessor
{
    public void ProcessMessage(string message)
    {
        Console.WriteLine($"Processing message: {message}");
    }
}

// Delegate declaration
public delegate void MyDelegate(string message);

public class Program
{
    public static void Main()
    {
        MessageProcessor processor = new MessageProcessor();
        MyDelegate delegateInstance = processor.ProcessMessage;

        // Invoking the delegate
        delegateInstance("Hello, Delegate!");
    }
}
```

#### å¤šæ’­å§”æ‰˜

å…è®¸ä¸€ä¸ªå§”æ‰˜å®ä¾‹æŒæœ‰å¤šä¸ªæ–¹æ³•çš„å¼•ç”¨ï¼Œå½“è°ƒç”¨è¯¥å§”æ‰˜æ—¶ï¼Œæ‰€æœ‰è¢«å¼•ç”¨çš„æ–¹æ³•éƒ½ä¼šæŒ‰ç…§æ·»åŠ é¡ºåºä¾æ¬¡æ‰§è¡Œã€‚

è¿™å¯èƒ½ä¼šå¢åŠ ç®¡ç†å’Œè°ƒè¯•çš„å¤æ‚æ€§ï¼Œå¦‚æœå¤„ç†ä¸å½“ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ„æƒ³ä¸åˆ°çš„å‰¯ä½œç”¨ã€‚

```csharp
public class Calculator
{
    public void Add(int a, int b)
    {
        Console.WriteLine($"Sum: {a + b}");
    }

    public void Multiply(int a, int b)
    {
        Console.WriteLine($"Product: {a * b}");
    }
}

// Delegate declaration
public delegate void MyDelegate(int a, int b);

public class Program
{
    public static void Main()
    {
        Calculator calculator = new Calculator();

        MyDelegate addDelegate = calculator.Add;
        MyDelegate multiplyDelegate = calculator.Multiply;

        // Creating a multicast delegate
        MyDelegate multicastDelegate = addDelegate + multiplyDelegate;

        // Invoking both methods
        multicastDelegate(3, 4);
    }
}
```

#### å†…ç½®æ³›å‹å§”æ‰˜ç±»å‹

åœ¨ `C#` ä¸­ï¼Œ`Func<T>` ç”¨äºè¿”å›å€¼çš„å§”æ‰˜ï¼Œ`Action<T>` ç”¨äºä¸è¿”å›å€¼çš„å§”æ‰˜ï¼Œ`Predicate<T>` ç”¨äºè¿”å›å¸ƒå°”å€¼çš„å§”æ‰˜ã€‚

```csharp
Func<int, int, int> add = (a, b) => a + b;
int result = add(5, 3);  // result = 8

// Calculate damage
Func<int, float, int> calculateDamage = (baseDamage, criticalMultiplier) =>
    (int)(baseDamage * criticalMultiplier);
```

```csharp
Action<string> logMessage = message => Console.WriteLine(message);
logMessage("Player attacked!");

// Character action
Action<Character> playerAttack = character => {
    character.TakeDamage(10);
    character.PlayAttackAnimation();
};
```

```csharp
Predicate<int> isEven = number => number % 2 == 0;
bool result = isEven(4);  // true

// Enemy filtering
Predicate<Enemy> isLowHealth = enemy => enemy.Health < 20;
List<Enemy> weakEnemies = enemyList.FindAll(isLowHealth);
```

### 2ã€äº‹ä»¶ ğŸ“£

äº‹ä»¶ä½¿ç”¨å§”æ‰˜æ¥é€šçŸ¥çŠ¶æ€æ›´æ”¹ï¼Œå…è®¸ä¸€ä¸ªå¯¹è±¡é€šçŸ¥å…¶ä»–å¯¹è±¡æœ‰å…³æŸäº›äº‹ä»¶çš„ä¿¡æ¯ã€‚

#### äº‹ä»¶å£°æ˜

```csharp
public class EventPublisher
{
    public event MyDelegate MyEvent;
}
```

#### è®¢é˜…äº‹ä»¶

```csharp
public class EventSubscriber
{
    public void Subscribe(EventPublisher publisher)
    {
        publisher.MyEvent += HandleEvent;
    }

    public void HandleEvent(string message)
    {
        Console.WriteLine($"Event handled: {message}");
    }
}
```

#### å‘å¸ƒäº‹ä»¶

```csharp
EventPublisher publisher = new EventPublisher();
EventSubscriber subscriber = new EventSubscriber();
subscriber.Subscribe(publisher);
publisher.MyEvent?.Invoke("Event message"); // Raising the event
```

#### äº‹ä»¶å¤„ç†ç¨‹åºå’Œ `EventArgs`

```csharp
public class CustomEventArgs : EventArgs
{
    public string EventMessage { get; }

    public CustomEventArgs(string message)
    {
        EventMessage = message;
    }
}

public class EventPublisher
{
    public event EventHandler<CustomEventArgs> MyEvent;

    public void RaiseEvent(string message)
    {
        OnMyEvent(new CustomEventArgs(message));
    }

    protected virtual void OnMyEvent(CustomEventArgs e)
    {
        MyEvent?.Invoke(this, e);
    }
}
```

### 3ã€ç»¼åˆä¾‹å­ ğŸ“š

```csharp
// Define delegate types
public delegate void AttackDelegate(string target);
public delegate int CalculateDamageDelegate(int baseAttack, int criticalChance);

public class GameCharacter(string name, int health, int attack)
{
    // Event delegates
    public event AttackDelegate? OnAttack;
    public event Action<string>? OnDeath;

    public string Name { get; } = name;
    private int Health { get; set; } = health;
    private int Attack { get; } = attack;

    // Perform attack using delegate
    public void PerformAttack(string target, CalculateDamageDelegate damageCalculator)
    {
        // Calculate damage
        int damage = damageCalculator(Attack, 20);

        // Trigger attack event
        OnAttack?.Invoke(target);

        Console.WriteLine($"{Name} attacks {target}, dealing {damage} damage");
    }

    public void TakeDamage(int damage)
    {
        Health -= damage;

        if (Health <= 0)
        {
            // Trigger death event
            OnDeath?.Invoke($"{Name} has fallen");
        }
    }
}

public abstract class SkillManager
{
    // Multicast delegate
    public delegate void SkillEventHandler(string skillName);
    public static event SkillEventHandler? OnSkillUsed;

    public static void UseSkill(string skillName, Action? skillAction)
    {
        // Trigger skill event
        OnSkillUsed?.Invoke(skillName);

        // Execute skill action
        skillAction?.Invoke();
    }
}

public class CombatLogger
{
    public void LogAttack(string target)
    {
        Console.WriteLine($"[Log] Attack target: {target}");
    }

    public void LogDeath(string deathMessage)
    {
        Console.WriteLine($"[Log] {deathMessage}");
    }
}

public class Program
{
    public static void Main()
    {
        GameCharacter hero = new GameCharacter("Hero", 100, 20);
        GameCharacter monster = new GameCharacter("Goblin", 50, 10);
        CombatLogger logger = new CombatLogger();

        // Register events
        hero.OnAttack += logger.LogAttack;
        hero.OnDeath += logger.LogDeath;
        monster.OnDeath += logger.LogDeath;

        // Register skill event
        SkillManager.OnSkillUsed += skillName =>
            Console.WriteLine($"[Skill] Used skill: {skillName}");

        // Define damage calculation delegate
        CalculateDamageDelegate standardDamage = (baseAttack, criticalChance) =>
        {
            Random random = new Random();
            bool isCritical = random.Next(100) < criticalChance;
            return isCritical ? baseAttack * 2 : baseAttack;
        };

        SkillManager.UseSkill("Fireball", () =>
        {
            Console.WriteLine("Casting a powerful fireball!");
        });

        hero.PerformAttack(monster.Name, standardDamage);
        monster.TakeDamage(25);

        // Func and Action delegate examples
        Func<int, int, int> multiply = (a, b) => a * b;
        Action<string> print = Console.WriteLine;

        Console.WriteLine($"Multiplication result: {multiply(5, 3)}");
        print("Delegate usage example");
    }
}
```
